import e from"https://cdn.skypack.dev/canvas-confetti";import{initializeApp as t}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getFirestore as s,collection as n,addDoc as a,getDocs as i,doc as o,getDoc as r,query as d,where as l}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{getAuth as m,signInAnonymously as c,onAuthStateChanged as y}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";let firebaseConfig={apiKey:"AIzaSyDjGUXCcnYPAal-EpZ0LQC8gUssxXDctU8",authDomain:"checkers-55f7b.firebaseapp.com",projectId:"checkers-55f7b",storageBucket:"checkers-55f7b.firebasestorage.app",messagingSenderId:"1030093131937",appId:"1:1030093131937:web:97bf76c27b987793a560e0",measurementId:"G-3EBZ8M8D6R"},app=t(firebaseConfig),db=s(app),auth=m(app),sessionId=new URLSearchParams(window.location.search).get("session")||sessionStorage.getItem("sessionId"),userId=null,username=sessionStorage.getItem("username")||null,senderUsername=null;document.addEventListener("DOMContentLoaded",async function(){let t=document.getElementById("yesButton"),s=document.getElementById("noButton"),m=document.getElementById("imageDisplay"),p=document.getElementById("valentineQuestion"),g=document.getElementById("responseButtons"),u=document.getElementById("sessionInfo"),I=document.getElementById("responsesList"),h=document.getElementById("responseSection"),f=document.getElementById("shareLinkContainer"),b=document.getElementById("createSessionBtn");c(auth).catch(e=>console.error("Auth Error:",e)),y(auth,async e=>{e&&(userId=e.uid,sessionId?sessionId===sessionStorage.getItem("sessionId")?(u.textContent="Match's Link Created! Share this:",g.style.display="none",b.classList.add("hidden"),f.innerHTML=`
    <input id="shareLink" class="border p-2" value="${window.location.href}?session=${sessionId}" readonly />
    <button id="copyLink" class="ml-2 bg-pink-500 text-white px-3 py-1 rounded">Copy</button>
  `,document.getElementById("copyLink").addEventListener("click",()=>{navigator.clipboard.writeText(document.getElementById("shareLink").value),alert("Link copied!")})):(sessionStorage.getItem(sessionId)&&(g.style.display="none",p.textContent="Hmmm, you have already Answered \uD83D\uDE12",b.style.display="block"),h.style.display="none",await k(),await w()):(u.textContent="No match's link found! Create a new one.",b.classList.remove("hidden"),g.style.display="none"),username||((username=prompt("Enter your name:"))||(username=`Guest_${Math.floor(1e3*Math.random())}`),sessionStorage.setItem("username",username)),await w())}),b.addEventListener("click",async()=>{let e=await a(n(db,"valentine_sessions"),{creatorId:userId,createdAt:new Date,username}),t=e.id;return sessionStorage.setItem("sessionId",t),u.textContent="Match's Link Created! Share it:",b.classList.add("hidden"),f.innerHTML=`
<input id="shareLink" class="border p-2" value="${window.location.href}?session=${t}" readonly />
<button id="copyLink" class="ml-2 bg-pink-500 text-white px-3 py-1 rounded">Copy</button>
`,document.getElementById("copyLink").addEventListener("click",()=>{navigator.clipboard.writeText(document.getElementById("shareLink").value),alert("Link copied!")}),t});let k=async()=>{if(sessionId)try{let e=await r(o(db,"valentine_sessions",sessionId));if(e.exists()){let t=e.data();senderUsername=t.username,document.getElementById("sessionInfo").textContent=`${t.username} says...`}else document.getElementById("sessionInfo").textContent="Match link not found!"}catch(s){console.error("Error fetching session:",s),document.getElementById("sessionInfo").textContent="Error loading match link!"}},w=async()=>{I.innerHTML="";let e=d(n(db,"valentine_responses"),l("sessionId","==",sessionId)),t=await i(e);t.forEach(e=>{let{username:t,response:s}=e.data(),n=document.createElement("tr");n.className="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200",n.innerHTML=`
                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                    ${t}
                </th>
                <td class="px-6 py-4">
                     ${s}
                </td>`,I.appendChild(n)})},E=async e=>{sessionId&&userId&&(await a(n(db,"valentine_responses"),{sessionId,userId,username,response:e,timestamp:new Date}),sessionStorage.setItem(sessionId,"done"),g.style.display="none",b.style.display="block")},$=0,L=48,x=80,B=20,C=["./images/image1.gif","./images/image2.gif","./images/image3.gif","./images/image4.gif","./images/image5.gif","./images/image6.gif","./images/image7.gif"];s.addEventListener("click",function(){$<5?($++,m.src=C[$],L+=35,x+=35,B+=25,t.style.height=`${L}px`,t.style.width=`${x}px`,t.style.fontSize=`${B}px`,$<6&&(s.textContent=["No","Are you sure?","Pookie please","Don't do this to me :(","You're breaking my heart","I'm gonna cry..."][$])):(E("No"),p.textContent="Ooooh Misery !!!\uD83D\uDE2D")}),t.addEventListener("click",()=>{m.src="./images/image7.gif",p.textContent="Yayyy!! \uD83D\uDC9E",g.style.display="none",e(),E("Yes"),document.getElementById("sessionInfo").textContent=`Happy Valentine ${username} & ${senderUsername} !!!❤️`})});